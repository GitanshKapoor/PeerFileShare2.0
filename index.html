<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Peer File Share</title>
</head>
<body>
    <h1>Peer File Share</h1>
    <input type="file" id="fileInput" />
    <button id="uploadButton">Upload</button>
    <div id="fileList"></div>
    <script src="https://unpkg.com/@azure/storage-blob@latest"></script>
    <script>
        const { BlobServiceClient } = require('@azure/storage-blob');

        const accountName = 'peerfileshare';
        const sasToken = 'sv=2022-11-02&ss=b&srt=co&sp=rwtfx&se=2026-10-05T13:40:36Z&st=2024-10-05T05:40:36Z&spr=https,http&sig=D7gPQwKz5uO1s9Z05ngplc82UheUnf5F6B4ZQFjpP%2Fo%3D';
        const containerName = 'uploads';

        const blobServiceClient = new BlobServiceClient(`https://${accountName}.blob.core.windows.net/?${sasToken}`);
        const containerClient = blobServiceClient.getContainerClient(containerName);

        document.getElementById('uploadButton').onclick = async () => {
            const file = document.getElementById('fileInput').files[0];
            const blobClient = containerClient.getBlockBlobClient(file.name);
            await blobClient.uploadBrowserFile(file);
            alert('File uploaded!');
        };

        async function listFiles() {
            let iter = containerClient.listBlobsFlat();
            let blobItem = await iter.next();
            while (!blobItem.done) {
                document.getElementById('fileList').innerHTML += `<a href="https://${accountName}.blob.core.windows.net/${containerName}/${blobItem.value.name}" target="_blank">${blobItem.value.name}</a><br/>`;
                blobItem = await iter.next();
            }
        }

        listFiles();
    </script>
</body>
</html>
